<polymer-element name="x-ddt" attributes="rigadamodificare">
	<template>
		<x-numerodoc val="{{ddt.numero}}" label="Numero"></x-numerodoc>
		<x-data val="{{ddt.data}}" label="Data"></x-data>
		<br>
		<x-codiceclientefornitore val="{{ddt.clientefornitore_codice}}" label="Cliente"></x-codiceclientefornitore>
		<br>
		<x-numerodoc val="{{ddt.fattura_numero}}" label="N.Fatt."></x-numerodoc>
		<x-data val="{{ddt.fattura_data}}" label="Data.Fatt."></x-data>

		<br>
		<x-codicecausale val="{{ddt.causale_codice}}" label="Causale di spedizione"></x-codicecausale>
		<br>
		<x-codicemezzo val="{{ddt.mezzo_codice}}" label="Mezzo di spedizione"></x-codicemezzo>
		<br>
		<x-codiceclientefornitore val="{{ddt.vettore_codice}}" label="Vettore"></x-codiceclientefornitore>
		<br>
		<x-note val="{{ddt.note}}" label="Note"></x-note>
		<br>
		Righe:
		<div style="heigth:10px;overflow-y: scroll;height: 50px;border:0.1em solid grey;box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.333333);padding:1em;" tabindex="">
		<template repeat="{{r in ddt.righe}}">
			<x-numeroriga val="{{r.numero}}" label="N."></x-numeroriga>
			<x-codicearticolo val="{{r.articolo_codice}}" label="Art."></x-codicearticolo>
			<x-codiceum val="{{r.um_codice}}" label="UM"></x-codiceum>
			<x-prezzo val="{{r.prezzo}}" label="Prezzo"></x-prezzo>
			<x-numerocolli val="{{r.colli}}" label="Colli"></x-numerocolli>
			<x-codiceimballaggio val="{{r.imballaggio_codice}}" label="Tipo Imb."></x-codiceimballaggio>
			<x-peso val="{{r.pesolordo}}" label="Lordo"></x-peso>
			<x-peso val="{{r.tara}}" label="Tara"></x-peso>
			<x-peso val="{{r.pesonetto}}" label="Netto"></x-peso>
			<x-lotto val="{{r.lotto}}" label="Lotto"></x-lotto>
			<x-codiceiva val="{{r.iva_codice}}" label="Iva"></x-codiceiva>
			<hr>
		</template>
		</div>
	<!-- -->
	<br>
	Modifica Riga
	<br>
	<template bind="{{rigadamodificare}}">
		<x-numeroriga val="{{numero}}" label="N." id="numRigaDaModificare"></x-numeroriga>
		<x-codicearticolo val="{{articolo_codice}}" label="Art."></x-codicearticolo>
		<x-codiceum val="{{um_codice}}" label="UM"></x-codiceum>
		<x-prezzo val="{{prezzo}}" label="Prezzo"></x-prezzo>
		<x-numerocolli val="{{colli}}" label="Colli"></x-numerocolli>
		<x-codiceimballaggio val="{{imballaggio_codice}}" label="Tipo Imball."></x-codiceimballaggio>
		<x-peso val="{{pesolordo}}" label="Lordo"></x-peso>
		<x-peso val="{{tara}}" label="Tara"></x-peso>
		<x-peso val="{{pesonetto}}" label="Netto"></x-peso>
		<x-lotto val="{{lotto}}" label="Lotto"></x-lotto>
		<x-codiceiva val="{{iva_codice}}" label="Iva"></x-codiceiva>
	</template>
	<!-- -->
	</template>
	<script>
		Polymer('x-ddt', {
			ready: function() {
				var ajax = {
				ddt:{
					_type:"Ddt",
					numero:"1934",
					data:"16/11/2013",
					clientefornitore_codice:"LAFAVO",
					causale_codice:"01",
					mezzo_codice:"01",
					vettore_codice:"03",
					fattura_numero:"",
					fattura_data:"",
					note:"Note per il ddt",
					righe: [
						{	numero: 0,
							articolo_codice: '01',
							um_codice: 'KG',
							prezzo: '0,001',
							colli: '10',
							imballaggio_codice: '01',
							pesolordo:'1000',
							tara:'100',
							pesonetto:'900',
							lotto:'1/A',
							iva_codice:'4',
							},
						{	numero: 1,
							articolo_codice: '03',
							um_codice: 'KG',
							prezzo: '0,001',
							colli: '10',
							imballaggio_codice: '01',
							pesolordo:'1000',
							tara:'100',
							pesonetto:'900',
							lotto:'1/A',
							iva_codice:'4',
							},
						{numero: 2, articolo: '02'},
						{numero: 3, articolo: '02'},
						{numero: 4, articolo: '02'},
						{numero: 5, articolo: '02'},
						]
				   }
				}
				this.ddt= ajax.ddt;
				//lavoro su una copia dell'oggetto
				
				this.rigadamodificare = {
							numero: '',
							articolo_codice: '01',
							um_codice: '',
							prezzo: '',
							colli: '',
							imballaggio_codice: '',
							pesolordo:'',
							tara:'',
							pesonetto:'',
							lotto:'',
							iva_codice:'',
							}//JSON.parse(JSON.stringify(this.ddt.righe[0]));
				console.log(this.ddt);
				
				//tengo traccia di quale riga del mio ddt sto modificando
				var numRigaWatcher = function (id, oldval, newval){
					console.log('numero changed: ',newval);
					if(newval!=''){
						//una nuova riga Ã¨ stata selezionate... ricerco i dati
						this.rigadamodificare=JSON.parse(JSON.stringify(this.ddt.righe[newval]));
					}else{
						//do nothing
					}
					//re register the watcher
					this.rigadamodificare.watch('numero',numRigaWatcher)
				}.bind(this)
				this.rigadamodificare.watch('numero',numRigaWatcher)
			},

		});
	</script>
</polymer-element>
