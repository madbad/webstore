<polymer-element name="x-ddt">
	<template>
		<x-window title="Gestione Ddt">
			<x-clientefornitore_codice></x-clientefornitore_codice>
			<x-numero></x-numero>
			<x-data></x-data>
			<x-causale_codice></x-causale_codice>
			<x-mezzo_codice></x-mezzo_codice>
			<x-vettore_codice></x-vettore_codice>
			<!--
			<x-note></x-note>
			<x-righe></x-righe>
			<x-riga></x-riga>
			-->
		</x-window>
	</template>
	<script>
	Polymer('x-ddt',{
		ready:function (){
			//manage keyboard events
			$(this).keydown(function(event) {
				switch (event.which){
					case 13://invio
						this.saveToDb();
					case 112://f1
						console.log('Delivering HELP to:');
						console.log(document.activeElement.parentNode.parentNode.tagName);
					//default: console.log(event);
				}
			});

			this.async(function() {

				var list = this.shadowRoot.getElementsByTagName("x-window")[0].getElementsByTagName("*");
				for (var i = 0; i< list.length; i++){
					var myElement = list[i];
					myElement.shadowRoot.getElementsByTagName("x-input")[0].mytitle = myElement.tagName.replace("X-","").toLowerCase();
				};

			}, null, 300);
		},
		toJson:function (){
			//my actual json object
			var myJson ={};
			myJson._type ='Ddt';

			var list = this.shadowRoot.getElementsByTagName("x-window")[0].getElementsByTagName("*");
			for (var i = 0; i< list.length ; i++){
				var myElement = list[i];
				var propName = myElement.tagName.replace("X-","").toLowerCase();
				myJson[propName] = myElement.value+Math.random();
			}
			var jsonString =  JSON.stringify(myJson);
			//console.log(jsonString);
			return jsonString;
		},
		saveToDb : function (){
			//perform an ajax request to get the list to display*
			$.ajax({
				type: "POST",
				url: "./../do.php",
				data: { action: 'save',
						params: this.toJson(),
				},
				context: this,
			}).done(function( msg ) {
				if (msg){
					console.log('ServerReply:');
					console.log(msg);
					//
					//var jsonList = $.parseJSON(msg);
					//this.jsonToTable(jsonList, $.parseJSON(this.params));
				}
			});
		},
	});
	</script>
</polymer-element>
